<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registrar Cuenta</title>
  <link rel="stylesheet" href="/static/css/estilos.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
  <div class="background"></div>
  <div class="card">
    <img class="logo" src="images.png" alt="Logo">
    <h4>¡Crea tu cuenta!</h4>
    <!-- Formulario de registro -->
    <form id="registerForm">
      <input type="text" id="nombre" name="nombre" placeholder="Nombre completo" required>
      <input type="email" id="correo" name="correo" placeholder="Correo electrónico" required>
      <input type="password" id="contrasena" name="contrasena" placeholder="Contraseña" required>
      <button type="submit">Registrarse</button>
    </form>

    <footer>
      ¿Ya tienes cuenta?
      <a href="sesion.html">Inicia sesión aquí</a>
    </footer>
  </div>

  <!-- Mostrar mensajes flash -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <ul>
        {% for category, message in messages %}
          <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  <script>
    // Enviar formulario con AJAX
    $('#registerForm').on('submit', function(e) {
      e.preventDefault();  // Evita el envío normal del formulario

      var nombre = $('#nombre').val();
      var correo = $('#correo').val();
      var contrasena = $('#contrasena').val();

      // Hacer la petición POST a Flask para registrar al usuario
      $.ajax({
        url: '/registrarse',  // URL de la API Flask para registro
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ nombre: nombre, correo: correo, contrasena: contrasena }),
        success: function(response) {
          if (response.status === 'success') {
            alert('Usuario registrado correctamente');
            window.location.href = '/sesion.html';  // Redirige a la página de login
          } else {
            alert('Error: ' + response.message);
          }
        },
        error: function() {
          alert('Error en la conexión');
        }
      });
    });
  </script>

</body>

</html>
