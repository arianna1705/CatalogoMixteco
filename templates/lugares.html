<!DOCTYPE html>
<html lang="es" class="h-100">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
	<meta name="author" content="AdminKit">
	<meta name="keywords" content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="shortcut icon" href="static/img/icons/icon-48x48.png" />

	<link rel="canonical" href="https://demo-basic.adminkit.io/lugares.html" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/static/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<link href="{{url_for('static', filename='css/app.css')}}" rel="stylesheet">

	<title>Blank Page | AdminKit Demo</title>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

	
</head>

<body>
	
	<div class="wrapper">
		<nav id="sidebar" class="sidebar js-sidebar">
			<div class="sidebar-content js-simplebar">
				<a class="sidebar-brand" href="{{ url_for('lugares') }}">
          <span class="align-middle">Administrador</span>
        </a>

				<ul class="sidebar-nav">
					<li class="sidebar-header">
						Apartados
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="{{ url_for('logout') }}">
              <i class="align-middle" data-feather="log-in"></i> <span class="align-middle">Cerrar sesión</span>
            </a>
					</li>    

					<li class="sidebar-item">
						<a class="sidebar-link" href="{{ url_for('show_login_page') }}">
              <i class="align-middle" data-feather="user-plus"></i> <span class="align-middle">Iniciar Sesión</span>
            </a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="{{ url_for('lugares') }}">
              <i class="align-middle" data-feather="book"></i> <span class="align-middle">Lugares</span>
            </a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="{{ url_for('imagenes') }}">
              <i class="align-middle" data-feather="book"></i> <span class="align-middle">Imagenes</span>
            </a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="{{ url_for('usuarios') }}">
              <i class="align-middle" data-feather="book"></i> <span class="align-middle">Usuarios</span>
            </a>
				</ul>

			
		</nav>

		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg">
				<a class="sidebar-toggle js-sidebar-toggle">
          <i class="hamburger align-self-center"></i>
        </a>

				<div class="navbar-collapse collapse">
					<ul class="navbar-nav navbar-align">
						<li class="nav-item dropdown">
							<a class="nav-icon dropdown-toggle" href="#" id="alertsDropdown" data-bs-toggle="dropdown">
								<div class="position-relative">
									<i class="align-middle" data-feather="bell"></i>
									<span class="indicator">4</span>
								</div>
							</a>
							<div class="dropdown-menu dropdown-menu-lg dropdown-menu-end py-0" aria-labelledby="alertsDropdown">
								<div class="dropdown-menu-header">
									4 New Notifications
								</div>
								<div class="list-group">
									<a href="#" class="list-group-item">
										<div class="row g-0 align-items-center">
											<div class="col-2">
												<i class="text-danger" data-feather="alert-circle"></i>
											</div>
											<div class="col-10">
												<div class="text-dark">Update completed</div>
												<div class="text-muted small mt-1">Restart server 12 to complete the update.</div>
												<div class="text-muted small mt-1">30m ago</div>
											</div>
										</div>
									</a>
									<a href="#" class="list-group-item">
										<div class="row g-0 align-items-center">
											<div class="col-2">
												<i class="text-warning" data-feather="bell"></i>
											</div>
											<div class="col-10">
												<div class="text-dark">Lorem ipsum</div>
												<div class="text-muted small mt-1">Aliquam ex eros, imperdiet vulputate hendrerit et.</div>
												<div class="text-muted small mt-1">2h ago</div>
											</div>
										</div>
									</a>
									<a href="#" class="list-group-item">
										<div class="row g-0 align-items-center">
											<div class="col-2">
												<i class="text-primary" data-feather="home"></i>
											</div>
											<div class="col-10">
												<div class="text-dark">Login from 192.186.1.8</div>
												<div class="text-muted small mt-1">5h ago</div>
											</div>
										</div>
									</a>
									<a href="#" class="list-group-item">
										<div class="row g-0 align-items-center">
											<div class="col-2">
												<i class="text-success" data-feather="user-plus"></i>
											</div>
											<div class="col-10">
												<div class="text-dark">New connection</div>
												<div class="text-muted small mt-1">Christina accepted your request.</div>
												<div class="text-muted small mt-1">14h ago</div>
											</div>
										</div>
									</a>
								</div>
								<div class="dropdown-menu-footer">
									<a href="#" class="text-muted">Show all notifications</a>
								</div>
							</div>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-icon dropdown-toggle" href="#" id="messagesDropdown" data-bs-toggle="dropdown">
								<div class="position-relative">
									<i class="align-middle" data-feather="message-square"></i>
								</div>
							</a>
							<div class="dropdown-menu dropdown-menu-lg dropdown-menu-end py-0" aria-labelledby="messagesDropdown">
								<div class="dropdown-menu-header">
									<div class="position-relative">
										4 New Messages
									</div>
								</div>
								<div class="list-group">
									<a href="#" class="list-group-item">
										<div class="row g-0 align-items-center">
											<div class="col-2">
												<img src="{{url_for('static', filename='img/avatars/avatar-5.jpg')}}" class="avatar img-fluid rounded-circle" alt="Vanessa Tucker">
											</div>
											<div class="col-10 ps-2">
												<div class="text-dark">Vanessa Tucker</div>
												<div class="text-muted small mt-1">Nam pretium turpis et arcu. Duis arcu tortor.</div>
												<div class="text-muted small mt-1">15m ago</div>
											</div>
										</div>
									</a>
									<a href="#" class="list-group-item">
										<div class="row g-0 align-items-center">
											<div class="col-2">
												<img src="{{url_for('static', filename='img/avatars/avatar-2.jpg')}}" class="avatar img-fluid rounded-circle" alt="William Harris">
											</div>
											<div class="col-10 ps-2">
												<div class="text-dark">William Harris</div>
												<div class="text-muted small mt-1">Curabitur ligula sapien euismod vitae.</div>
												<div class="text-muted small mt-1">2h ago</div>
											</div>
										</div>
									</a>
									<a href="#" class="list-group-item">
										<div class="row g-0 align-items-center">
											<div class="col-2">
												<img src="{{url_for('static', filename='img/avatars/avatar-4.jpg')}}" class="avatar img-fluid rounded-circle" alt="Christina Mason">
											</div>
											<div class="col-10 ps-2">
												<div class="text-dark">Christina Mason</div>
												<div class="text-muted small mt-1">Pellentesque auctor neque nec urna.</div>
												<div class="text-muted small mt-1">4h ago</div>
											</div>
										</div>
									</a>
									<a href="#" class="list-group-item">
										<div class="row g-0 align-items-center">
											<div class="col-2">
												<img src="{{url_for('static', filename='img/avatars/avatar-3.jpg')}}" class="avatar img-fluid rounded-circle" alt="Sharon Lessman">
											</div>
											<div class="col-10 ps-2">
												<div class="text-dark">Sharon Lessman</div>
												<div class="text-muted small mt-1">Aenean tellus metus, bibendum sed, posuere ac, mattis non.</div>
												<div class="text-muted small mt-1">5h ago</div>
											</div>
										</div>
									</a>
								</div>
								<div class="dropdown-menu-footer">
									<a href="#" class="text-muted">Show all messages</a>
								</div>
							</div>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-icon dropdown-toggle d-inline-block d-sm-none" href="#" data-bs-toggle="dropdown">
                <i class="align-middle" data-feather="settings"></i>
              </a>

							<a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#" data-bs-toggle="dropdown">
                <img src="{{url_for('static', filename='img/logo-img.jpg')}}" class="avatar img-fluid rounded me-1" alt="Encanto Mixteco" /> <span class="text-dark">Encanto Mixteco</span>
              </a>
						</li>
					</ul>
				</div>
			</nav>

<!-- CRUD DE LUGARES -->
<div class="container py-5">
    <h2>Catálogo de Lugares Turísticos</h2>
    <p>Administra los lugares turísticos</p>

    <!-- Botón para abrir el SweetAlert -->
    <button class="btn btn-primary mb-3" id="btn-agregar-lugar">
        Agregar Lugar
    </button>

    <!-- Tabla de lugares -->
    <table class="table table-striped table-bordered">
        <thead class="bg-primary text-white">
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Ubicación</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tabla-lugares"></tbody>
    </table>
</div>

<footer class="footer">
    <div class="container-fluid"></div>
</footer>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const tablaLugares = document.getElementById("tabla-lugares");

        // Cargar lugares
        fetch('/api/lugares')
            .then(res => res.json())
            .then(data => {
                data.forEach(lugar => {
                    const fila = `
                        <tr>
                            <td>${lugar.id_lugar}</td>
                            <td>${lugar.nom_lugar}</td>
                            <td>${lugar.descripcion}</td>
                            <td>${lugar.ubicacion}</td>
                            <td>
                                <button class="btn btn-warning btn-sm" onclick="editarLugar(${lugar.id_lugar})">Editar</button>
                                <button class="btn btn-danger btn-sm" onclick="eliminarLugar(${lugar.id_lugar})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                    tablaLugares.innerHTML += fila;
                });
            });


			// Botón para abrir SweetAlert con formulario para agregar un nuevo lugar
document.getElementById("btn-agregar-lugar").addEventListener("click", () => {
    Swal.fire({
        title: 'Agregar Lugar Turístico',
        html: `
            <input type="text" id="nom_lugar" class="swal2-input" placeholder="Nombre" required>
            <input type="text" id="descripcion" class="swal2-input" placeholder="Descripción" required>
            <input type="text" id="ubicacion" class="swal2-input" placeholder="Ubicación" required>
        `,
        showCancelButton: true,
        confirmButtonText: 'Guardar',
        cancelButtonText: 'Cancelar',
        preConfirm: () => {
            const nom_lugar = document.getElementById('nom_lugar').value;
            const descripcion = document.getElementById('descripcion').value;
            const ubicacion = document.getElementById('ubicacion').value;

            if (!nom_lugar || !descripcion || !ubicacion) {
                Swal.showValidationMessage('Por favor, rellena todos los campos');
                return false;
            }

            return { nom_lugar, descripcion, ubicacion };
        }
    }).then((result) => {
        if (result.isConfirmed) {
            const nuevoLugar = {
                nom_lugar: result.value.nom_lugar,
                descripcion: result.value.descripcion,
                ubicacion: result.value.ubicacion,
                estatus: 1,
                usu_mod: "admin",
                ult_mod: "Creación",
                fecha_mov: new Date().toISOString().split('T')[0]
            };

            // Enviar datos a la API para agregar el nuevo lugar
            fetch('/api/lugares', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(nuevoLugar)
            })
            .then(res => res.json())
            .then(data => {
                Swal.fire('¡Guardado!', data.message, 'success');
                location.reload();
            })
            .catch(err => {
                console.error(err);
                Swal.fire('Error', 'No se pudo agregar el lugar', 'error');
            });
        }
    });
});

        // Función para editar lugar - GLOBAL
        window.editarLugar = (id) => {
            fetch(`/api/lugares/${id}`)
                .then(res => res.json())
                .then(lugar => {
                    // Mostrar formulario SweetAlert con valores precargados
                    Swal.fire({
                        title: 'Editar Lugar Turístico',
                        html: `
                            <input type="text" id="nom_lugar" class="swal2-input" value="${lugar.nom_lugar}" placeholder="Nombre">
                            <input type="text" id="descripcion" class="swal2-input" value="${lugar.descripcion}" placeholder="Descripción">
                            <input type="text" id="ubicacion" class="swal2-input" value="${lugar.ubicacion}" placeholder="Ubicación">
                        `,
                        showCancelButton: true,
                        confirmButtonText: 'Guardar',
                        cancelButtonText: 'Cancelar',
                        preConfirm: () => {
                            const nom_lugar = document.getElementById('nom_lugar').value;
                            const descripcion = document.getElementById('descripcion').value;
                            const ubicacion = document.getElementById('ubicacion').value;

                            if (!nom_lugar || !descripcion || !ubicacion) {
                                Swal.showValidationMessage('Por favor, rellena todos los campos');
                                return false;
                            }

                            return { nom_lugar, descripcion, ubicacion };
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            const lugarActualizado = {
                                nom_lugar: result.value.nom_lugar,
                                descripcion: result.value.descripcion,
                                ubicacion: result.value.ubicacion,
                                estatus: 1,
                                usu_mod: "admin",
                                ult_mod: "Edición",
                                fecha_mov: new Date().toISOString().split('T')[0]
                            };

                            // Enviar actualización a la API
                            fetch(`/api/lugares/${id}`, {
                                method: 'PUT',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(lugarActualizado)
                            })
                            .then(res => res.json())
                            .then(data => {
                                Swal.fire('¡Actualizado!', data.message, 'success');
                                location.reload();
                            })
                            .catch(err => {
                                console.error(err);
                                Swal.fire('Error', 'No se pudo actualizar el lugar', 'error');
                            });
                        }
                    });
                })
                .catch(err => {
                    console.error(err);
                    Swal.fire('Error', 'No se pudo cargar el lugar', 'error');
                });
        };

        // Función para eliminar lugar
        window.eliminarLugar = (id) => {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "No podrás revertir esta acción",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/api/lugares/${id}`, { method: 'DELETE' })
                        .then(res => res.json())
                        .then(data => {
                            Swal.fire('¡Eliminado!', data.message, 'success');
                            location.reload();
                        })
                        .catch(err => {
                            console.error(err);
                            Swal.fire('Error', 'No se pudo eliminar el lugar', 'error');
                        });
                }
            });
        };
    });
</script>

<!-- Scripts necesarios -->
<script src="{{url_for('static', filename='js/jquery.min.js')}}"></script>
<script src="{{url_for('static', filename='js/bootstrap.min.js')}}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>

</html>